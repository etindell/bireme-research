{% extends "base.html" %}

{% block title %}News - Bireme Research{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto space-y-6">
    <!-- Header -->
    <div class="md:flex md:items-center md:justify-between">
        <div class="min-w-0 flex-1">
            <h1 class="text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl">
                News
            </h1>
            <p class="mt-1 text-sm text-gray-500">
                {% if unread_count > 0 %}
                {{ unread_count }} unread item{{ unread_count|pluralize }}
                {% else %}
                All caught up
                {% endif %}
            </p>
        </div>
        <div class="mt-4 flex gap-x-3 md:ml-4 md:mt-0">
            <form method="post" action="{% url 'news:fetch_all' %}">
                {% csrf_token %}
                <button type="submit"
                        class="inline-flex items-center rounded-md bg-primary-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-primary-500">
                    <svg class="-ml-0.5 mr-1.5 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99" />
                    </svg>
                    Fetch News
                </button>
            </form>
            <a href="{% url 'news:manage_blacklist' %}"
               class="inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                <svg class="-ml-0.5 mr-1.5 h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
                </svg>
                Blocked Sources
            </a>
            {% if unread_count > 0 %}
            <form hx-post="{% url 'news:mark_all_read' %}" hx-swap="none">
                {% csrf_token %}
                <button type="submit"
                        class="inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                    <svg class="-ml-0.5 mr-1.5 h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                    </svg>
                    Mark All Read
                </button>
            </form>
            {% endif %}
        </div>
    </div>

    <!-- Filters -->
    <div class="bg-white shadow rounded-lg p-4">
        <form method="get" class="flex flex-wrap gap-4 items-end">
            <!-- Company filter -->
            <div class="flex-1 min-w-[200px]">
                <label for="company" class="block text-sm font-medium text-gray-700 mb-1">Company</label>
                <select id="company" name="company"
                        class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm">
                    <option value="">All Companies</option>
                    {% for company in companies %}
                    <option value="{{ company.slug }}" {% if current_company == company.slug %}selected{% endif %}>
                        {{ company.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Importance filter -->
            <div class="w-40">
                <label for="importance" class="block text-sm font-medium text-gray-700 mb-1">Importance</label>
                <select id="importance" name="importance"
                        class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm">
                    <option value="">All</option>
                    <option value="high" {% if current_importance == 'high' %}selected{% endif %}>High</option>
                    <option value="medium" {% if current_importance == 'medium' %}selected{% endif %}>Medium</option>
                    <option value="low" {% if current_importance == 'low' %}selected{% endif %}>Low</option>
                </select>
            </div>

            <!-- Source filter -->
            <div class="w-40">
                <label for="source" class="block text-sm font-medium text-gray-700 mb-1">Source</label>
                <select id="source" name="source"
                        class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm">
                    <option value="">All Sources</option>
                    <option value="web" {% if current_source == 'web' %}selected{% endif %}>Web Search</option>
                    <option value="sec_edgar" {% if current_source == 'sec_edgar' %}selected{% endif %}>SEC EDGAR</option>
                </select>
            </div>

            <!-- Checkboxes -->
            <div class="flex items-center gap-4">
                <label class="flex items-center">
                    <input type="checkbox" name="unread" value="1" {% if show_unread %}checked{% endif %}
                           class="h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-600">
                    <span class="ml-2 text-sm text-gray-700">Unread only</span>
                </label>
                <label class="flex items-center">
                    <input type="checkbox" name="starred" value="1" {% if show_starred %}checked{% endif %}
                           class="h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-600">
                    <span class="ml-2 text-sm text-gray-700">Starred</span>
                </label>
            </div>

            <!-- Submit -->
            <button type="submit"
                    class="inline-flex items-center rounded-md bg-primary-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-primary-500">
                Filter
            </button>

            {% if current_company or current_importance or current_source or show_unread or show_starred %}
            <a href="{% url 'news:dashboard' %}"
               class="text-sm text-gray-500 hover:text-gray-700">
                Clear filters
            </a>
            {% endif %}
        </form>
    </div>

    <!-- News list -->
    <div id="news-list">
        {% include "news/partials/news_list.html" %}
    </div>
</div>
{% endblock %}
