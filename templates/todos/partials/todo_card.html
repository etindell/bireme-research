<div id="todo-{{ todo.pk }}"
     class="px-4 py-4 sm:px-6 {% if todo.is_completed %}bg-gray-50{% endif %}"
     :class="{ 'ring-2 ring-inset ring-primary-500 bg-primary-50': {% if selectable %}selectMode && isSelected({{ todo.pk }}){% else %}false{% endif %} }">
    <div class="flex items-start gap-x-4">
        {% if selectable %}
        <!-- Bulk select checkbox (shown in select mode) -->
        <div x-show="selectMode" x-cloak class="flex-shrink-0 mt-0.5" @click.stop="toggleTodo({{ todo.pk }})">
            <div class="h-6 w-6 rounded border-2 flex items-center justify-center transition-colors cursor-pointer"
                 :class="isSelected({{ todo.pk }}) ? 'bg-primary-600 border-primary-600' : 'border-gray-300 bg-white hover:border-gray-400'">
                <svg x-show="isSelected({{ todo.pk }})" class="h-4 w-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                </svg>
            </div>
        </div>
        {% endif %}

        <!-- Complete checkbox -->
        <button hx-post="{% url 'todos:toggle_complete' todo.pk %}"
                hx-target="#todo-{{ todo.pk }}"
                hx-swap="outerHTML"
                class="mt-0.5 flex-shrink-0"
                {% if selectable %}x-show="!selectMode"{% endif %}>
            {% if todo.is_completed %}
            <svg class="h-6 w-6 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
            </svg>
            {% else %}
            <svg class="h-6 w-6 text-gray-300 hover:text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <circle cx="12" cy="12" r="9" />
            </svg>
            {% endif %}
        </button>

        <!-- Content -->
        <div class="min-w-0 flex-1">
            <div class="flex items-center gap-x-2 flex-wrap">
                <a href="{% url 'todos:detail' todo.pk %}"
                   class="text-sm font-medium {% if todo.is_completed %}text-gray-500 line-through{% else %}text-gray-900{% endif %} hover:text-primary-600">
                    {{ todo.title }}
                </a>
                {% if todo.category %}
                <span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium"
                      style="background-color: {{ todo.category.color }}20; color: {{ todo.category.color }}">
                    {{ todo.category.name }}
                </span>
                {% endif %}
                {% if todo.priority and todo.priority != 'none' %}
                <span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium
                    {% if todo.priority == 'high' %}bg-red-100 text-red-700
                    {% elif todo.priority == 'medium' %}bg-yellow-100 text-yellow-700
                    {% elif todo.priority == 'low' %}bg-blue-100 text-blue-600
                    {% endif %}">
                    {{ todo.get_priority_display }}
                </span>
                {% endif %}
                {% if todo.is_auto_generated %}
                <span class="inline-flex items-center rounded-full bg-purple-100 px-2 py-0.5 text-xs font-medium text-purple-700">
                    Auto
                </span>
                {% endif %}
                {% if todo.todo_type == 'investor_letter' %}
                <span class="inline-flex items-center rounded-full bg-amber-100 px-2 py-0.5 text-xs font-medium text-amber-700">
                    Letter Review
                </span>
                {% endif %}
            </div>

            <div class="mt-1 flex items-center gap-x-4 text-sm text-gray-500 flex-wrap">
                {% if todo.company %}
                <a href="{{ todo.company.get_absolute_url }}" class="hover:text-primary-600">
                    {{ todo.company.name }}
                </a>
                {% endif %}
                {% if todo.quarter %}
                <span>{{ todo.quarter }}</span>
                {% endif %}
                <span>{{ todo.created_at|timesince }} ago</span>
                {% if todo.is_completed and todo.completed_at %}
                <span class="text-green-600">Completed {{ todo.completed_at|timesince }} ago</span>
                {% endif %}
            </div>
        </div>

        <!-- Actions -->
        <div class="flex items-center gap-x-2 flex-shrink-0">
            {% if not todo.is_completed and todo.company %}
            <a href="{% url 'todos:complete_with_note' todo.pk %}"
               class="inline-flex items-center text-sm font-medium text-green-600 hover:text-green-500"
               title="Complete and write a note as evidence">
                <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                </svg>
                Note
            </a>
            {% endif %}
            {% if todo.todo_type == 'investor_letter' %}
            <a href="{% url 'todos:investor_letter' todo.pk %}"
               class="text-sm font-medium text-primary-600 hover:text-primary-500">
                Review
            </a>
            {% endif %}
            <a href="{% url 'todos:update' todo.pk %}"
               class="text-sm text-gray-400 hover:text-gray-500">
                Edit
            </a>
        </div>
    </div>
</div>
